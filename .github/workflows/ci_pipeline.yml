name: CI Pipeline

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  # JOB 1: Quality & Security (Runs tests using uv)
  security-tests:
    name: Run Security Tests (uv)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v5
        
      - name: Set up Python 3.12
        run: uv python install 3.12

      - name: Install dependencies
        run: uv sync

      - name: Run Pytest
        run: uv run pytest

  # JOB 2: Docker Verification (Ensures the image builds)
  docker-build:
    name: Verify Docker Build
    runs-on: ubuntu-latest
    needs: security-tests
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build Docker Image
        run: docker build .